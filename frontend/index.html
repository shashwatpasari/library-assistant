<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>LibraryHub - Welcome</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="apple-touch-icon" href="/favicon.svg" />
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&amp;family=Caveat:wght@400;500;600;700&amp;display=optional"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#3A86FF",
                        "secondary": "#FFBE0B",
                        "background-light": "#F8F9FA",
                        "background-dark": "#111921",
                        "text-light": "#212529",
                        "text-dark": "#f8f9fa",
                        "border-light": "#DEE2E6",
                        "border-dark": "#343a40"
                    },
                    fontFamily: {
                        "display": ["'DM Sans'", "system-ui", "sans-serif"],
                        "heading": ["'Caveat'", "system-ui", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "0.5rem", "lg": "0.75rem", "xl": "1rem", "full": "9999px" },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            font-size: 24px;
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Shared search bar behavior for all pages */
        .search-container #search-input,
        .search-container #search-input:hover,
        .search-container #search-input:focus {
            border-width: 1.5px;              /* EXACT same thickness always */
            border-color: #e5e7eb;            /* default gray-200 */
            outline: none;
            box-shadow: none;                 /* kill any focus ring from Tailwind/forms */
            transition: border-color 150ms ease;
        }

        .search-container #search-dropdown {
            border-width: 1.5px;
            border-color: #e5e7eb;            /* default gray-200 */
        }

        /* Hover (only when not focused): lighter blue */
        .search-container:hover #search-input:not(:focus) {
            border-color: #93c5fd;            /* blue-300 */
        }

        /* Focus (clicked): deeper blue on bar and results, overrides hover completely */
        .search-container:focus-within #search-input,
        .search-container:focus-within #search-input:hover {
            border-color: #2563eb;            /* deep blue */
        }

        .search-container:focus-within #search-dropdown {
            border-color: #2563eb;            /* match deep blue */
        }

        /* Placeholder text uses heading font, typed text uses body font */
        .search-container #search-input::placeholder {
            font-family: 'Caveat', system-ui, sans-serif;
            font-size: 1.05rem;
        }

        /* Prevent layout shifts during page navigation */
        header {
            min-height: 60px;
        }

        body {
            font-display: optional;
        }
    </style>
</head>

<body class="font-display bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark">
    <div class="relative flex min-h-screen w-full flex-col">
        <!-- Header will be inserted here -->
        <div id="header-container"></div>
        <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
            <section class="mb-12">
                <div class="bg-primary/10 dark:bg-primary/15 rounded-xl p-8 lg:p-12 text-center">
                    <h1
                        class="font-heading text-4xl lg:text-[2.6rem] font-normal leading-snug tracking-tight text-primary dark:text-white mb-4">
                        Welcome to LibraryHub</h1>
                    <p
                        class="text-lg lg:text-xl text-text-light dark:text-text-dark max-w-4xl mx-auto leading-relaxed">
                        Your gateway to a world of knowledge and adventure. Discover new stories, revisit old classics,
                        and connect with a community of readers.
                    </p>
                </div>
            </section>
            <section>
                <h2
                    class="font-heading text-3xl font-normal leading-tight tracking-tight text-text-light dark:text-text-dark mb-6">
                    Available Now</h2>
                <div id="featured-books"
                    class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                    <!-- Books will be loaded here -->
                </div>
            </section>
        </main>
        <footer class="mt-auto border-t border-border-light dark:border-border-dark bg-white dark:bg-gray-900">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div class="flex flex-col md:flex-row justify-between items-center gap-6">
                    <p class="text-sm text-gray-600 dark:text-gray-400">Â© 2024 Library Management. All Rights Reserved.
                    </p>
                </div>
            </div>
        </footer>
        <!-- Chat widget will be inserted here -->
        <div id="chat-widget-container"></div>
    </div>
    <script type="module">
        import { fetchBooks, getBookCoverUrl, formatAuthors } from './src/services/api.js';
        import { renderHeader, initHeader } from './src/components/header.js';
        import { renderChatWidget, initChatWidget } from './src/components/chat-widget.js';

        // Initialize header
        document.getElementById('header-container').innerHTML = renderHeader();
        initHeader();

        // Initialize chat widget
        document.getElementById('chat-widget-container').innerHTML = renderChatWidget();
        initChatWidget();

        /**
         * Shuffle array using Fisher-Yates algorithm
         */
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        async function loadFeaturedBooks() {
            const container = document.getElementById('featured-books');
            if (!container) return;

            try {
                // Fetch a larger sample of books to randomize from
                const allBooks = await fetchBooks({ skip: 0, limit: 100 });

                // Randomly shuffle and select 10 books
                const shuffledBooks = shuffleArray(allBooks);
                const featuredBooks = shuffledBooks.slice(0, 10);

                container.innerHTML = featuredBooks.map((book, index) => {
                    const coverUrl = getBookCoverUrl(book);
                    // First 3 images should load with high priority (above the fold)
                    const fetchPriority = index < 3 ? 'high' : 'auto';
                    const loading = index < 3 ? 'eager' : 'lazy';

                    return `
            <div class="flex flex-col gap-3 group">
                <a href="book-details.html?id=${book.id}" class="w-full aspect-[2/3] rounded-lg overflow-hidden shadow-md group-hover:shadow-xl transition-shadow bg-gray-200 dark:bg-gray-700 relative">
                    <div class="absolute inset-0 flex items-center justify-center bg-gray-200 dark:bg-gray-700 animate-pulse">
                        <div class="w-8 h-8 border-4 border-gray-300 dark:border-gray-600 border-t-primary rounded-full animate-spin"></div>
                    </div>
                    <img 
                        src="${coverUrl}" 
                        alt="${escapeHtml(book.title)} cover" 
                        class="w-full h-full object-cover relative z-10"
                        loading="${loading}"
                        fetchpriority="${fetchPriority}"
                        decoding="async"
                        onload="this.previousElementSibling.style.display='none';"
                        onerror="this.style.display='none'; this.previousElementSibling.innerHTML='<div class=\\'w-full h-full flex items-center justify-center text-gray-400 text-xs\\'>No Image</div>'; this.previousElementSibling.style.display='flex';"
                    />
                </a>
                <div>
                    <h3 class="font-bold text-lg leading-tight text-[#111418] dark:text-white">${escapeHtml(book.title)}</h3>
                    <p class="text-sm text-[#637588] dark:text-gray-400 line-clamp-2" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;">${escapeHtml(formatAuthors(book))}</p>
                </div>
            </div>
        `;
                }).join('');
            } catch (error) {
                console.error('Error loading books:', error);
                container.innerHTML = '<p class="text-red-500">Error loading books. Make sure the backend is running.</p>';
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }


        loadFeaturedBooks();
    </script>
</body>

</html>